<?php

	namespace App\GsBase;

	

	class GsBase {
		//parametros de conexion
		private $url="198.97.56.64";
		private $puerto=8122;
		private $ejercicio="madisa";
		private $empresa="madisa mti";
		private $aplicacion="gsges_madisa";
		private $usua="";
		private $passw="";
		private $ventana="aa-incidencias-web";

		public $usuario;
		public $password;
		public $accion;
		public $argumentos;

		function __construct($usuario,$password){
			$this->usuario=$usuario;
			$this->password=$password;
		}

		
		function ejecuta(){
			
			$resultado="";
			// Creamos el objeto conexi�n
			$miconexion = new gsbSocket;

			// Abrimos la conexi�n al servidor gsBase
			$respu = $miconexion->Connect($this->url, $this->puerto);
			if ($respu != 0){
				$resultado="2";
			}

			// Hacemos la identificaci�n en el servidor gsBase
			$respu = $miconexion->Logon($this->empresa,$this->usua,$this->passw,$this->aplicacion,$this->ejercicio,'','');

			if ($respu != 0){
				$miconexion->Disconnect();
				$resultado = "1";
			}else{
				// Ejecutamos la consulta
				$respu = $miconexion->rgsb($this->accion, $this->ventana, $this->argumentos);
				if ($respu==""){
					if ($miconexion->GetLastErrorStr() == ""){
						$miconexion->Disconnect();
						$resultado="3";
					}
					else{
						$miconexion->Disconnect();
						$resultado="4".$miconexion->GetLastErrorStr();
					}
				}
				else{
					$miconexion->Disconnect();
					$resultado=$respu;
				}
				
				//$miconexion->Disconnect();
			}

			return $resultado;
		}
		
	}
		
	class gsbSocket{ 
		var $B2530S8971; var $LE30M5511; var $E5T30M9988; var $S2530B8971; var $S52V30O99R88; var $P52U30O99T00; var $E3WP52UA; var $NA1FFP665U4; var $E373RR99C10;  function __construct(){ $this->E5T30M9988 = 0;  $this->S2530B8971 = chr(2); $this->LE30M5511 = ""; return 0; } function Config($R9E8FAAE8C9F2C11F2603FD75D2EC8A89,$R35C3E30782E3B5C4B6905D11E5B16D72,$R2E16DC47EB051C99E19417EC3F31B1D8,$R3FA8F91904FA5E8CD4330D3B8F19271F,$RB5BBE765C22A725F5E4AB05B64A51739){   $this->S52V30O99R88 = $R9E8FAAE8C9F2C11F2603FD75D2EC8A89; $this->P52U30O99T00 = $R35C3E30782E3B5C4B6905D11E5B16D72;  $this->E3WP52UA = $R2E16DC47EB051C99E19417EC3F31B1D8;  $this->NA1FFP665U4 = $R3FA8F91904FA5E8CD4330D3B8F19271F; $this->E373RR99C10 = $RB5BBE765C22A725F5E4AB05B64A51739; }   function Execute($RA6F6E7185B4D658CC5AEFDA94DEF7A2C,$RBE449D3B682E7D67E9761FC6A70B6AD2,$R46B1C0DCFC8E55644B26C8FCCE50D192,$RE0D5EDB560A26D4E1BECD832EA026E32,$RB148E7F41FDC3BE4B14E8D17E068BBAD,$R438EE0B4C26D4DA967CEB335173DA2F0=false){  $R79488E1CB0B3E3575CDB235589871794 = $this->Connect($this->S52V30O99R88, $this->P52U30O99T00);  if ($R79488E1CB0B3E3575CDB235589871794 != 0){   return array(-1,"NO SE PUDO CONECTAR:" . $this->GetLastErrorStr());  }   $R79488E1CB0B3E3575CDB235589871794 = $this->Logon($this->E3WP52UA, $RE0D5EDB560A26D4E1BECD832EA026E32, $RB148E7F41FDC3BE4B14E8D17E068BBAD, $this->NA1FFP665U4, $this->E373RR99C10, "", "");  if ($R79488E1CB0B3E3575CDB235589871794 != 0){ return array(-1,"NO SE PUDO HACER LOGON:" . $this->GetLastErrorStr());  }   if ($R438EE0B4C26D4DA967CEB335173DA2F0==true) $R46B1C0DCFC8E55644B26C8FCCE50D192 = serialize($R46B1C0DCFC8E55644B26C8FCCE50D192);    $R8C2633EF994A8D2726C9E21D34E70F8C = -999;   $R4002603E450F0DB8D5A7FF540344175C = "PROBLEMA INDETERMINADO!!";    $R79488E1CB0B3E3575CDB235589871794 = $this->rgsb($RA6F6E7185B4D658CC5AEFDA94DEF7A2C, $RBE449D3B682E7D67E9761FC6A70B6AD2, $R46B1C0DCFC8E55644B26C8FCCE50D192);  if ($R79488E1CB0B3E3575CDB235589871794==""){   if ($this->GetLastErrorStr() != ""){  $R8C2633EF994A8D2726C9E21D34E70F8C = -1;   $R4002603E450F0DB8D5A7FF540344175C = $this->GetLastErrorStr();  }  }    else{   $R8C2633EF994A8D2726C9E21D34E70F8C = 0;  $R4002603E450F0DB8D5A7FF540344175C = $R79488E1CB0B3E3575CDB235589871794;  if ($R438EE0B4C26D4DA967CEB335173DA2F0==true) $R79488E1CB0B3E3575CDB235589871794 = unserialize($R79488E1CB0B3E3575CDB235589871794);   }   $this->Disconnect();  return array($R8C2633EF994A8D2726C9E21D34E70F8C,$R4002603E450F0DB8D5A7FF540344175C);  }  function GetLastErrorStr(){   return $this->LE30M5511;  }   function Connect($R9CFB7C6D6B20D54B665E8CE30A6486F2,$R954AEF838645F5452EA7F1B5C0F0B423){ $this->LE30M5511 = "";  if($this->E5T30M9988 != 0){  $this->Disconnect(); $this->LE30M5511 = "Error: La conexion no estaba cerrada!";  return -1;  }  $R32D00070D4FFBCCE2FC669BBA812D4C2="";  $R5F525F5B398DADD7CF0784BD406298E3=""; $RE3DA88E893AD8415C8338FF7FA8B635F = fsockopen($R9CFB7C6D6B20D54B665E8CE30A6486F2,$R954AEF838645F5452EA7F1B5C0F0B423,$R32D00070D4FFBCCE2FC669BBA812D4C2,$R5F525F5B398DADD7CF0784BD406298E3); if (!$RE3DA88E893AD8415C8338FF7FA8B635F){ $this->LE30M5511 = "No se pudo conectar. Error: ". $R32D00070D4FFBCCE2FC669BBA812D4C2 ." ". $R5F525F5B398DADD7CF0784BD406298E3;  return -1; }  $R68CFAA8D4F687999430C9F1AE93C8807="";  while (true){  $R3E33E017CD76B9B7E6C7364FB91E2E90 = fgets($RE3DA88E893AD8415C8338FF7FA8B635F,2);  $R68CFAA8D4F687999430C9F1AE93C8807 .= $R3E33E017CD76B9B7E6C7364FB91E2E90;  if (chr(1).chr(2) == substr($R68CFAA8D4F687999430C9F1AE93C8807,-2)) break;  }  $this->B2530S8971 = $RE3DA88E893AD8415C8338FF7FA8B635F; $this->E5T30M9988 = 1;  return 0;  } function Disconnect(){  $this->LE30M5511="";  try{  fclose($this->B2530S8971); }  catch(Exception $R5431C56219CE28A0520B9CF966FBE6CE){  $this->LE30M5511="Error al Desconectar: " . $R5431C56219CE28A0520B9CF966FBE6CE->getMessage();   return -1;  }  $this->E5T30M9988=0;  return 0; }  function Logon($R26E1DE44AE9497F46EC33A33E095E8AE, $RD22AFCF8424E54EADF02000F8F7A60A7, $RC173460ECF7F4EE67716AC28D44F56D7, $R87FF51CE9FBD299555121505C03BF41B, $RE5F9F3F55213EE1F9C528EA1680AE592, $R32395DA5817993F82434DD1529F14EC5, $R996BEE98A63C3798FE55F9EBCBAB2047){ $R4E3575FE5FB519DB2860A9F3EA5C5E95 = "p_logon"; $RD29EDB54C93DFBAD2F7CFBEB59A5B794 = $R26E1DE44AE9497F46EC33A33E095E8AE.",".$RD22AFCF8424E54EADF02000F8F7A60A7.",".$RC173460ECF7F4EE67716AC28D44F56D7.",".$R87FF51CE9FBD299555121505C03BF41B.",".$RE5F9F3F55213EE1F9C528EA1680AE592.",".$R32395DA5817993F82434DD1529F14EC5.",".$R996BEE98A63C3798FE55F9EBCBAB2047;  $R79488E1CB0B3E3575CDB235589871794="";  $this->Envia($R4E3575FE5FB519DB2860A9F3EA5C5E95,$RD29EDB54C93DFBAD2F7CFBEB59A5B794,$R79488E1CB0B3E3575CDB235589871794);  $RB113C6C509BC4EA3F35E2C19148D8ED2 = explode($this->S2530B8971, $R79488E1CB0B3E3575CDB235589871794);  if ($RB113C6C509BC4EA3F35E2C19148D8ED2[0] != "Ok"){  $this->LE30M5511 = $RB113C6C509BC4EA3F35E2C19148D8ED2[1]; return -1;  } return 0; }  function rgsb($RA6F6E7185B4D658CC5AEFDA94DEF7A2C, $RBE449D3B682E7D67E9761FC6A70B6AD2, $RD29EDB54C93DFBAD2F7CFBEB59A5B794){  $R79488E1CB0B3E3575CDB235589871794="";  $R4E3575FE5FB519DB2860A9F3EA5C5E95 = $RA6F6E7185B4D658CC5AEFDA94DEF7A2C . "|" . $RBE449D3B682E7D67E9761FC6A70B6AD2;  if ($this->Envia($R4E3575FE5FB519DB2860A9F3EA5C5E95,$RD29EDB54C93DFBAD2F7CFBEB59A5B794,$R79488E1CB0B3E3575CDB235589871794) != 0){  return "";  }  $RB113C6C509BC4EA3F35E2C19148D8ED2 = explode($this->S2530B8971, $R79488E1CB0B3E3575CDB235589871794);  if ($RB113C6C509BC4EA3F35E2C19148D8ED2[1] != ""){  $this->LE30M5511 = $RB113C6C509BC4EA3F35E2C19148D8ED2[1];  return "";  }  return $RB113C6C509BC4EA3F35E2C19148D8ED2[0]; } function Envia($RA6F6E7185B4D658CC5AEFDA94DEF7A2C,$R6157E037F7BEFDE0C4AA5FE57C53D296,&$R79488E1CB0B3E3575CDB235589871794){  $RBE7775088E4D935118D73EF2BB860D22 = $RA6F6E7185B4D658CC5AEFDA94DEF7A2C . $this->S2530B8971 . $R6157E037F7BEFDE0C4AA5FE57C53D296;  $this->LE30M5511="";  $this->E5T30M9988 = 3;  $R4BB7FB8B493561188A5B098F2E9FA112 = dechex(strlen($RBE7775088E4D935118D73EF2BB860D22));   while (strlen($R4BB7FB8B493561188A5B098F2E9FA112)<6) $R4BB7FB8B493561188A5B098F2E9FA112 = "0".$R4BB7FB8B493561188A5B098F2E9FA112;  $RBE7775088E4D935118D73EF2BB860D22 = $R4BB7FB8B493561188A5B098F2E9FA112 . $RBE7775088E4D935118D73EF2BB860D22; fputs($this->B2530S8971,$RBE7775088E4D935118D73EF2BB860D22);  $R3989107CCF8B1B52F136805C601C60F2 = fgets($this->B2530S8971, 7);  $RF5F11A8D38D2AF447803CE98A8C3E58E = hexdec($R3989107CCF8B1B52F136805C601C60F2); $R111F1B5B84B5C819EA9AE35968FCE466 = 1024; $R79488E1CB0B3E3575CDB235589871794 = "";  $R77980FBC97F6EBC2059A5BC30A33F02F = 0;  while (true){  if ($RF5F11A8D38D2AF447803CE98A8C3E58E<1) break;  if ($RF5F11A8D38D2AF447803CE98A8C3E58E<$R111F1B5B84B5C819EA9AE35968FCE466) $R111F1B5B84B5C819EA9AE35968FCE466=$RF5F11A8D38D2AF447803CE98A8C3E58E; $R7318A606A3118D468DAE7078098FBA7B= fgets($this->B2530S8971, $R111F1B5B84B5C819EA9AE35968FCE466+1);  $R79488E1CB0B3E3575CDB235589871794 .= $R7318A606A3118D468DAE7078098FBA7B; $RF5F11A8D38D2AF447803CE98A8C3E58E = $RF5F11A8D38D2AF447803CE98A8C3E58E - strlen($R7318A606A3118D468DAE7078098FBA7B);  $R77980FBC97F6EBC2059A5BC30A33F02F+=1;  }  return 0; } 
		function gsbSocket(){ self::__construct(); }
	} 
	
?>